# Initial setup
cd /workspace
git clone https://github.com/devasphn/Voxtral-Orpheus
cd Voxtral-Orpheus

# Install system dependencies
apt-get update
apt-get install -y python3-pip python3-venv build-essential ffmpeg libsndfile1-dev git nano tmux lsof

# Set up Hugging Face
pip install huggingface-hub
huggingface-cli login

# === VOXTRAL SERVICE ===
cd /workspace/Voxtral-Orpheus/voxtral_service
python3 -m venv venv
source venv/bin/activate

# Install PyTorch first for CUDA support
pip install torch==2.4.0 torchaudio==2.4.0 --index-url https://download.pytorch.org/whl/cu121

# Install flash-attention (critical for performance)
pip install flash-attn==2.7.1 --no-build-isolation

# Install other requirements
pip install -r requirements.txt

# Launch Voxtral service
echo "=== Starting Voxtral Service on Port 8002 ==="
uvicorn main:app --host 0.0.0.0 --port 8002 &

# === ORPHEUS SERVICE ===
cd /workspace/Voxtral-Orpheus/orpheus_service
python3 -m venv venv
source venv/bin/activate

# Install Orpheus TTS
pip install orpheus-speech

# Install other requirements
pip install -r requirements.txt

# Launch Orpheus service
echo "=== Starting Orpheus Service on Port 8000 ==="
uvicorn main:app --host 0.0.0.0 --port 8000 &

# === GATEWAY SERVICE ===
cd /workspace/Voxtral-Orpheus/gateway
python3 -m venv venv
source venv/bin/activate

# Set environment variables
export ORPHEUS_URL="http://localhost:8000"
export VOXTRAL_URL="http://localhost:8002"

# Install requirements
pip install -r requirements.txt

# Launch gateway service
echo "=== Starting Gateway Service on Port 8555 ==="
uvicorn main:app --host 0.0.0.0 --port 8555
